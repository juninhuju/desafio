<div class="container">
  <div class="card simulador">
    <h3>Simulador de Investimento</h3>

    <div class="inputs">
      <label>
        Valor a Investir (R$)
        <input type="number" [(ngModel)]="simulador.valor" min="100" />
      </label>
      <label>
        Prazo (meses)
        <input type="number" [(ngModel)]="simulador.prazoMeses" min="1" />
      </label>
      <label>
        Tipo
        <select [(ngModel)]="simulador.tipo">
          <option value="CDB">CDB</option>
        </select>
      </label>
    </div>

    <button (click)="simularInvestimento()">Simular</button>

    <div class="result" *ngIf="resultadoSimulador">
      <p><strong>Valor Final:</strong> {{ formatCurrency(resultadoSimulador.valorFinal) }}</p>
      <p><strong>Rentabilidade:</strong> {{ resultadoSimulador.rentabilidade * 100 | number:'1.2-2' }}% a.a.</p>
      <p class="detalhes">{{ resultadoSimulador.detalhes }}</p>
    </div>
  </div>

  <h2>Mais Investimentos</h2>

  <div class="grid">
    <div class="card" *ngFor="let product of products">
      <h3>{{ product.nome }}</h3>
      <p><strong>Tipo:</strong> {{ product.tipo }}</p>
      <p><strong>Rentabilidade:</strong> {{ product.rentabilidade * 100 | number:'1.2-2' }}% a.a.</p>
      <p><strong>Risco:</strong> {{ product.risco }}</p>

      <div class="inputs">
        <label>
          Valor a Investir (R$)
          <input type="number" [(ngModel)]="product.valorInput" min="100" />
        </label>
        <label>
          Prazo (meses)
          <input type="number" [(ngModel)]="product.prazoInput" min="1" />
        </label>
      </div>

      <div class="risk-alert" *ngIf="product.isMismatched">
        <p>⚠️ Este produto está fora do seu perfil ({{ userProfile }}).</p>
        <label>
          <input type="checkbox" [(ngModel)]="product.confirmedMismatch" />
          Concordo que, para investir, é necessário responder novamente à Análise de Perfil do Investidor (API).
        </label>
      </div>

      <button (click)="simulate(product)"
        [disabled]="
          !product.valorInput ||
          !product.prazoInput ||
          product.valorInput <= 0 ||
          product.prazoInput <= 0 ||
          (product.isMismatched && !product.confirmedMismatch)
        ">
        {{ product.simulatedResult ? 'Limpar Simulação' : 'Simular' }}
      </button>

      <div class="result" *ngIf="product.simulatedResult">
        <p><strong>Valor Final:</strong> {{ formatCurrency(product.simulatedResult.valorFinal) }}</p>
        <p><strong>Rentabilidade:</strong> {{ product.simulatedResult.rentabilidade * 100 | number:'1.2-2' }}% a.a.</p>
        <p class="detalhes">{{ product.simulatedResult.detalhes }}</p>

        <div class="chart">
          <ngx-charts-area-chart
            [results]="product.simulatedResult.chartData"
            [customColors]="chartCustomColors"
            [xAxis]="true"
            [yAxis]="true"
            [showXAxisLabel]="true"
            [showYAxisLabel]="true"
            xAxisLabel="Mês"
            yAxisLabel="Valor (R$)"
            [autoScale]="true"
            [gradient]="true">
          </ngx-charts-area-chart>
        </div>
      </div>
    </div>
  </div>
</div>
