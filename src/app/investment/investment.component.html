<div class="investment-teaser-container">
  <h2 class="section-title">Investimentos</h2>

  <div class="filter-tabs">
    <button 
      mat-button 
      [class.active]="activeTab === 'Conservador'" 
      (click)="filterProducts('Conservador')">
      Conservador
    </button>
    <button 
      mat-button 
      [class.active]="activeTab === 'Moderado'" 
      (click)="filterProducts('Moderado')">
      Moderado
    </button>
    <button 
      mat-button 
      [class.active]="activeTab === 'Agressivo'" 
      (click)="filterProducts('Agressivo')">
      Agressivo
    </button>
  </div>

  <div class="products-grid">
    <mat-card 
      *ngFor="let product of currentProducts" 
      class="product-card" 
      [class.conservative]="product.tipoRisco === 'Conservador'"
      [class.moderate]="product.tipoRisco === 'Moderado'"
      [class.aggressive]="product.tipoRisco === 'Agressivo'">
      
      <div class="card-header-bg">
        <h3>{{ product.tipoRisco }}</h3>
      </div>
      
      <div class="card-content-body">
        <h4>{{ product.nome }}</h4>
        <p class="description">{{ product.descricao }}</p>
        
        <!-- ✅ Rentabilidade formatada com PercentPipe -->
        <p class="data-point">
        <strong>Rentabilidade:</strong> {{ product.rentabilidade | percent:'1.2-2':'pt-BR' }}
        </p>

        <p class="data-point">IR sobre o rendimento | Resgate D+0</p>
        
        <div class="input-fields-row">
          <div class="input-group">
            <label for="valor-{{ product.id }}">Valor</label>
            <input 
              id="valor-{{ product.id }}"
              type="number" 
              [(ngModel)]="product.simulationValue" 
              min="100" 
              required 
              class="value-input">
          </div>
          
          <div class="input-group">
            <label for="prazo-{{ product.id }}">Prazo</label>
            <input 
              id="prazo-{{ product.id }}"
              type="number" 
              [(ngModel)]="product.simulationTermMonths" 
              min="1" 
              required 
              class="term-input">
          </div>
        </div>

        <div class="action-row">
          <span class="final-value">
            <ng-container *ngIf="product.simulationResult as result; else zeroValue">
              <ng-container *ngIf="result.valorFinal > 0">
                {{ result.valorFinal | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
              </ng-container>
              <ng-container *ngIf="result.valorFinal <= 0">
                R$ 0,00 
              </ng-container>
            </ng-container>
            <ng-template #zeroValue>R$ 0,00</ng-template>
          </span> 
          
          <button 
            mat-raised-button 
            (click)="simulateInvestment(product)"
            [disabled]="product.simulationLoading || product.simulationValue < 1 || product.simulationTermMonths < 1"
            class="simulate-button">
            {{ product.simulationLoading ? 'Calculando...' : 'Simular' }}
          </button>
        </div>
        
        <div class="chart-container">
          <ngx-charts-line-chart 
            *ngIf="product.simulationChartData.length > 0"
            [view]="[140, 60]" 
            [results]="product.simulationChartData" 
            [xAxis]="false" 
            [yAxis]="false" 
            [legend]="false" 
            [showXAxisLabel]="false"
            [showYAxisLabel]="false"
            [scheme]="'vivid'">
          </ngx-charts-line-chart>
          
          <div *ngIf="product.simulationChartData.length === 0 && !product.simulationLoading" class="chart-placeholder">
            [Gráfico ngx-charts aqui]
          </div>
        </div>
      </div>
    </mat-card>
  </div>
</div>
